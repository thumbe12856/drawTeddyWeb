<!DOCTYPE HTML>
<html>
	<head>
		<style>
		body {
			margin: 0px;
			margin-left: 300px;
			margin-top: 100px;
			padding: 0px;
		}

		#myCanvas {
			border: 1px solid #9C9898;
			transform: scale(1, -1);
		}
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script>

		var canvas;
		var context;
		$(document).ready(function() {
			canvas = document.getElementById('myCanvas');
			context = canvas.getContext('2d');
			getMesh();
		});
			
		var meshPosition;
		function getMesh() {
			$.ajax({
		        url: './teddy.json',
	            type: "GET",
	            error: function(error){
			    },
			    success: function(data)
			    {
			    	var position = [];
			    	var i;
			    	for(i=0; i<data.length; i++)
					{
						position[i] = [];
						position[i][0] = data[i]['pos'][0] *= 500;
						position[i][1] = data[i]['pos'][1] *= 500;
					}
					meshPosition = position;
					getPolygon(position);
			    }
			});	
		}

		var meshInterval;
		var polygonData;
		function getPolygon(position) {
			$.ajax({
	        	url: './teddy_poly.json',
        	    type: "GET",
    	        error: function(error){
			    },
			    success: function(data)
			    {
			    	polygonData = data;
			    	meshInterval = setInterval(drawPolygon, 1);
			    }
			});
		}

		var meshI = 0;
		function drawPolygon()
		{
			if(meshI >= polygonData.length) {
				clearTimeout(meshInterval);
				getSkeleton();
				return;
			}
			context.beginPath();
			var data = polygonData;
			var position = meshPosition;
			var i = meshI;
			context.moveTo(position[data[i]][0], position[data[i]][1]);
            context.lineTo(position[data[i+1]][0], position[data[i+1]][1]);
			context.moveTo(position[data[i+1]][0], position[data[i+1]][1]);
            context.lineTo(position[data[i+2]][0], position[data[i+2]][1]);	
			context.moveTo(position[data[i+2]][0], position[data[i+2]][1]);
            context.lineTo(position[data[i]][0], position[data[i]][1]);
			context.lineWidth = 1;
			context.strokeStyle = '#000000';
			context.stroke();
			meshI = meshI + 3;
		}
		
		var skeletonInterval;
		var skeletonData;
		function getSkeleton() {
			$.ajax({
		        url: './skeleton.json',
	            type: "GET",
	            error: function(error){
			    },
			    success: function(data)
			    {
			    	skeletonData = data;
					skeletonInterval = setInterval(drawSkeleton, 300);
			    }
			});
		}

		var skeletonI = 0;
		var skeletonPosition = [];
		function drawSkeleton() 
		{
			if(skeletonI >= skeletonData.length) {
				clearTimeout(skeletonInterval);
				return;
			}
			context.beginPath();
			context.strokeStyle = '#00ff00';
			context.lineWidth = 10;

			var i = skeletonI;
			var data = skeletonData;
			var position = skeletonPosition;
			
			data[i][1] *= 500;
			data[i][2] *= 500;
				
			position[data[i][0]] = [];
			position[data[i][0]][0] = data[i][1];
			position[data[i][0]][1] = data[i][2];
				
			if(i == 0) context.moveTo(400, 250);
			else {
				context.moveTo(position[data[i][4]][0], position[data[i][4]][1]);
				context.lineTo(data[i][1], data[i][2]);
				context.stroke();
			}
			skeletonI++;
		}

		</script>
	</head>

	<body>
		<canvas id="myCanvas" width="1500" height="500"></canvas>
	</body>
</html>
